<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: TestInteraction.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: TestInteraction.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Util = require("../util/Util");
const REQUEST_TYPES = ["Display.ElementSelected", "LaunchRequest", "SessionEndedRequest"];

/**
 * Represents a single interaction inside of a Test
 */
class TestInteraction {
    /**
     *
     * @param {Test} test - the test that includes this interaction
     * @param {string} utterance
     */
    constructor(test, utterance) {
        this._test = test;
        this._utterance = utterance;
        this._requestExpressions = [];
        this._assertions = [];
    }

    /**
     * Returns the assertions inside the interaction
     * @return {Assertion[]}
     */
    get assertions() {
        return this._assertions;
    }

    /**
     * Returns the duration of the interaction
     * @return {int}
     */
    get duration() {
        return this._duration;
    }

    /**
     * Set the duration of the interaction
     * @param {int} duration
     */
    set duration(duration) {
        this._duration = duration;
    }
    /**
     * Returns the expressions inside the interaction
     * @return {Expression[]}
     */
    get expressions() {
        return this._requestExpressions;
    }

    /**
     * Returns true if one of the assertions in the interaction includes a goto
     * @return {Assertion}
     */
    get hasGoto() {
        return this.assertions.find(assertion => assertion.goto !== undefined);
    }

    /**
     * Returns true if one of the assertions in the interaction includes an exit
     * @return {Assertion}
     */
    get hasExit() {
        return this.assertions.find(assertion => assertion.exit);
    }

    /**
     * Returns the intent set in the interaction (only for unit tests)
     * @return {string}
     */
    get intent() {
        return this._intent;
    }

    /****
     * Sets the intent inside the interaction
     * @param {string} intent
     */
    set intent(intent) {
        this._intent = intent;
    }

    /**
     * returns the line number of the interaction
     * @return {number}
     */
    get lineNumber() {
        return this._lineNumber;
    }

    /****
     * Sets the line number of the interaction
     * @param {number} lineNumber
     */
    set lineNumber(lineNumber) {
        this._lineNumber = lineNumber;
    }

    /**
     * If the utterance matches a request type (Display.ElementSelected, LaunchRequest, SessionEndedRequest), returns it
     * @return {string|undefined}
     */
    get requestType() {
        if (REQUEST_TYPES.includes(this._utterance)) {
            return this._utterance;
        }

        return undefined;
    }

    /**
     * Returns the slots used along the intents (only for unit tests)
     * @return {Array}
     */
    get slots() {
        return this._slots;
    }

    /**
     * Set the slots used along the intents (only for unit tests)
     * @param {Array} slots
     */
    set slots(slots) {
        this._slots = slots;
    }

    /**
     * Returns the test that includes this interaction
     * @return {Test}
     */
    get test() {
        return this._test;
    }

    /**
     * Returns the utterance as a string
     * @return {string}
     */
    get utterance() {
        if (this._localizedUtterance) {
            return this._localizedUtterance + "";
        }
        return this._utterance + "";
    }

    /****
     * Set the utterance
     * @param {string} utterance
     */
    set utterance(utterance) {
        this._utterance = utterance;
    }

    /****
     * Set the localizedUtterance
     * @param {string} localizedUtterance
     */
    set localizedUtterance(localizedUtterance) {
        this._localizedUtterance = localizedUtterance;
    }

    /**
     * Replace the property indicated by the expression path with the value indicated
     * @param {object} request - the request generated by this interaction
     */
    applyExpressions(request) {
        for (const expression of this.expressions) {
            expression.apply(request);
        }
    }

    /**
     * returns the relative index for this interaction inside the test
     * @return {number}
     */
    get relativeIndex() {
        return this._relativeIndex;
    }

    /****
     * Sets the relative index for this interaction inside the test
     * @param {number} index
     */
    set relativeIndex(index) {
        this._relativeIndex = index;
    }

    /**
     * Get the value of the slots used for the locale defined in the test suite
     * @return {Array}
     */
    get localizedSlots() {
        const slots = this._slots;
        const testSuite = this.test.testSuite;
        if (slots &amp;&amp; testSuite) {
            return Object.keys(slots).reduce((accumulator, key) => {
                accumulator[key] = testSuite.getLocalizedValue(slots[key]) || slots[key];
                return accumulator;
            }, {});
        }
        return slots;
    }

    /**
     * returns the label used for this interaction, so that it can be referenced in "go to" flows
     * @return {string}
     */
    get label() {
        return this._label;
    }

    /****
     * set the label used for this interaction, so that it can be referenced in "go to" flows
     * @param {string} label
     */
    set label(label) {
        this._label = label;
    }

    /**
     * Returns true if at least one of the assertions in this interaction has operator "==" or "=~"
     * @return {boolean}
     */
    get hasDeprecatedOperators() {
        return this.assertions &amp;&amp; this.assertions.some(assertion => ["==","=~"].includes(assertion.originalOperator));
    }

    /**
     * Returns true if at least one of the assertions in this interaction has operator ">", ">=", "&lt;" and "&lt;="
     * @return {boolean}
     */
    get hasDeprecatedE2EOperators() {
        return this.assertions &amp;&amp;
            this.assertions.some(assertion => [">", ">=","&lt;","&lt;="].includes(assertion.originalOperator));
    }

    /**
     * Returns a non-circular DTO version of this Test Interaction
     * @param {object} response - the response that was generated with this interaction
     * @return {{assertions: Array, expressions: Expression[], intent: string, lineNumber: number, relativeIndex: number, requestType: (string|undefined), testDescription: string, utterance: string}}
     */
    toDTO(response) {
        let assertions = [];
        try {
            assertions = this.assertions.map((assertion) => {
                const testSuite = this.test.testSuite;
                const value = (testSuite &amp;&amp; testSuite.getLocalizedValue(assertion.value)) || assertion.value;

                return {
                    actual: response &amp;&amp; response.json ?
                        assertion.valueAtPath(response.json) : "",
                    operator: assertion.operator,
                    originalOperator: assertion.originalOperator,
                    passed: response ? assertion.evaluate(response) : false,
                    path: assertion.path,
                    result: (response &amp;&amp; response.json) ?
                        assertion.toString(response.json) : "",
                    value,
                };
            });
        } catch (error) {
            // eslint-disable-next-line no-console
            console.log(error);
        }

        return {
            assertions,
            expressions: this.expressions,
            intent: this.intent,
            lineNumber: this.lineNumber,
            relativeIndex: this.relativeIndex,
            requestType: this.requestType,
            testDescription: Util.cleanString(this.test.description),
            utterance: this.utterance,
        };
    }

    /**
     * Returns the interaction part of a yaml object
     * {input: string, expect: object[]}
     * @return {object}
    */
    toYamlObject() {
        return {
            expected: this.assertions.map(assertion => assertion.toYamlObject()),
            input: this.utterance,
        };
    }
}

module.exports = TestInteraction;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Assertions.html">Assertions</a></li><li><a href="Expression.html">Expression</a></li><li><a href="InteractionResult.html">InteractionResult</a></li><li><a href="ParserError.html">ParserError</a></li><li><a href="Test.html">Test</a></li><li><a href="TestInteraction.html">TestInteraction</a></li><li><a href="TestParser.html">TestParser</a></li><li><a href="TestResult.html">TestResult</a></li><li><a href="TestSuite.html">TestSuite</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Mon Sep 02 2019 13:41:17 GMT-0500 (-05)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
